pipeline {
  agent {
    kubernetes {
      yamlFile ".ngci/agent-pod.yaml"
    }
  }

  options {
    timestamps()
    buildDiscarder(logRotator(numToKeepStr: "10", artifactNumToKeepStr: "10"))
  }

  environment {
    NGCI_VERSION                  = "5.0"
    JSON_FILE                     = ".ngci/ngci.json"
    HARBOR_REGISTRY               = credentials("harbor-rw")
    DOCKER_PUSH_REGISTRY_USER     = "${env.HARBOR_REGISTRY_USR}"
    DOCKER_PUSH_REGISTRY_PASSWORD = "${env.HARBOR_REGISTRY_PSW}"
    DOCKER_BASE_IMAGE_NAME        = "harbor.mellanox.com/cloud-orchestration-dev/mz-test-delete-me"
  }

  // parameters {
  //   string(name: "JSON_FILE", description: "JSON file path", defaultValue: ".ngci/ngci.json")
  // }

  stages {
    stage("Init") {
      steps {
        script {
          library changelog: false, identifier: "ngci@${NGCI_VERSION}"
          LoadNGCI()
        }
      }
    }
  }
}
