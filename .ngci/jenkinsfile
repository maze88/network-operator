pipeline {
  agent {
    kubernetes {
      yamlFile ".ngci/agent-pod.yaml"
    }
  }

  options {
    timestamps()
    buildDiscarder(logRotator(numToKeepStr: "10", artifactNumToKeepStr: "10"))
  }

  environment {
    NGCI_VERSION                  = "5.0"
    JSON_FILE                     = ".ngci/ngci.json"
    DOCKER_BASE_IMAGE_NAME        = "harbor.mellanox.com/cloud-orchestration-dev/network-operator-mzeevi-test"
    HARBOR_REGISTRY               = credentials("harbor-rw")
    DOCKER_PUSH_REGISTRY_USER     = "${env.HARBOR_REGISTRY_USR}"
    DOCKER_PUSH_REGISTRY_PASSWORD = "${env.HARBOR_REGISTRY_PSW}"
    ENABLE_CIA                    = "false"
  }

  stages {
    stage("Init") {
      steps {
        script {
          library changelog: false, identifier: "ngci@${NGCI_VERSION}"
          LoadNGCI()
        }
      }
    }
  }
}
