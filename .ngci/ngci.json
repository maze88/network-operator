{
  "author": "mzeevi@nvidia.com",
  "agentConfig": [
    {
      "type": "pod",
      "libraryResource": "com/nvidia/blossom/agentTemplates/kaniko_arm64_pod.yaml",
      "label": "arm64-agent"
    }
  ],
  "phases": [
    {
      "Build": [
        {
          "name": "Build amd64",
          "module": "com.nvidia.ngci.modules.docker.kanikoBuild",
          "container": "kaniko",
          "parameters": {
            "PLATFORM": "amd64",
            "DOCKERFILE_CONTEXT" : "."
          }
        },
        {
          "name": "Clone arm64",
          "module": "com.mellanox.jenkins.generic_modules.Checkout",
          "container": "kaniko-arm:arm64-agent",
          "parameters": {
            "GIT_REPOSITORY": "https://github.com/Mellanox/network-operator.git",
            "CLONE_PATH": "network-operator",
            "BRANCH_NAME": "master"
          }
        },
        {
          "name": "Build arm64",
          "module": "com.nvidia.ngci.modules.docker.kanikoBuild",
          "container": "kaniko-arm:arm64-agent",
          "parameters": {
            "PLATFORM": "arm64",
            "DOCKERFILE_CONTEXT": "."
          },
          "wait_for": "Clone arm64"
        }
      ]
    },
    {
      "Package": [
        {
          "name": "Manifest",
          "module": "com.nvidia.ngci.modules.docker.manifest",
          "container": "dind",
          "parameters": {
            "PLATFORMS_LIST": "amd64, arm64"
          }
        }
      ]
    }
  ]
}
